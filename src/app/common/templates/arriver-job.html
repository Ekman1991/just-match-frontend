<section class="user-job-wrapper">
    <user-job-header></user-job-header>
    <div class="main-title pink" ng-show="ctrl.showStatus">
        <div class="job-owner-header">
            <div ng-show="!ctrl.accepted && !ctrl.will_perform">
                <!-- Wait owner choose candidate -->
                <div>
                    <h2>{{ "assignment.status.applied" | translate }}</h2>
                </div>
            </div>
            <div ng-show="ctrl.accepted && !ctrl.will_perform">
                <!-- Owner choose you -->
                <div>
                    <h2>Vi vill anlita dig svara inom {{ctrl.remainHours}}h {{ctrl.remainMinutes}}min</h2>
                </div>
                <div>
                    <a class="button" href="" ng-click="userModalPerformShow=1">{{ "assignment.status.reply" | translate }}</a>
                </div>
            </div>
            <div ng-show="ctrl.will_perform && !ctrl.performed">
                <!-- Job finish report your boss -->
                <div ng-show="!that.canPerformed">
                    <h2>Du är anlitad</h2>
                </div>
                <div ng-show="that.canPerformed">
                    <h2>Är uppdraget utfort?</h2>
                </div>
                <div>
                    <a class="button" href="" ng-click="userModalPerformShow = 3-userModalPerformShow">Skicka
                        meddellanden</a>
                </div>
                <div ng-show="that.canPerformed || true">
                    <a class="button" href="" ng-click="userModalPerformShow=2">Ja</a>
                </div>
            </div>
        </div>

    </div>
    <div class="main-content" ng-hide="userModalPerformShow">
        <ul>
            <li class="select"><a href="#{{routes.arriver.job_comments.resolve(job_obj)}}"><span>Kommentarer</span><br />
                {{comments_amt}} kommentarer</a></li>
            <li class="select" ng-repeat="chat in ctrl.userChats.data">
                <a href="" ng-click="ctrl.gotoChat(chat.id);"><span>Chatt</span><br>Meddelanden från {{job.company.attributes.name}}</a>
            </li>
        </ul>

    </div>

    <div class="main-content user-modal-perform-show" ng-show="userModalPerformShow">
        <!-- USER modal form will-perform -->
        <div ng-show="userModalPerformShow==1">
            <section ng-show="!isWillPerform">

                <h4>
                    Grattis!<br/>
                    {{company_name}} vill garna att du utfor uppdraget
                </h4>
                <p>Vill du fortfalande ta uppdraget</p>
                <div>
                    <a class="button dark" href="" ng-click="userModalPerformShow=false">Nej</a>
                    <a class="button pink" href="" ng-click="isWillPerform=true">Ja</a>

                </div>
                <h3>Var god ge ett besked<br>
                    inom:<br>
                    {{ctrl.remainHours}} h {{ctrl.remainMinutes}} min</h3>
            </section>
            <section ng-show="isWillPerform">
                <h3>Kontuppgifter</h3>
                <p>Var vill du atr vi satter in ersattingen nar du utfort uppdraget?</p>
                <div class="material-input">

                    <form name="form" novalidate ng-submit="ctrl.createBankAccount()">
                        <validation form="form" field="account_clearing_number"
                                    errormsg="finance.form.account_clearing_number.validation_error">
                            <div class="group">
                                <input type="text" name="account_clearing_number"
                                       ng-required="ctrl.financeModel.data.attributes['account-number'] || (!ctrl.financeModel.data.attributes.iban && !ctrl.financeModel.data.attributes.bic)"
                                       ng-model="ctrl.financeModel.data.attributes['account-clearing-number']"/>
                                <label>Bank</label>
                            </div>
                        </validation>

                        <validation form="form" field="account_number"
                                    errormsg="finance.form.account_number.validation_error">
                            <div class="group">
                                <input type="text" name="account_number"
                                       ng-required="ctrl.financeModel.data.attributes['account-clearing-number']"
                                       ng-model="ctrl.financeModel.data.attributes['account-number']"/>
                                <label>Kortnummer</label>
                            </div>
                        </validation>

                        <validation form="form" field="iban" errormsg="finance.form.iban.validation_error">
                            <div class="group">
                                <input type="text" name="iban"
                                       ng-required="ctrl.financeModel.data.attributes.bic || (!ctrl.financeModel.data.attributes['account-clearing-number'] && !ctrl.financeModel.data.attributes['account-number'])"
                                       ng-model="ctrl.financeModel.data.attributes.iban"/>
                                <label>IBAN - nummer</label>
                            </div>
                        </validation>

                        <validation form="form" field="bic" errormsg="finance.form.bic.validation_error">
                            <div class="group">
                                <input type="text" name="bic"
                                       ng-required="ctrl.financeModel.data.attributes.iban"
                                       ng-model="ctrl.financeModel.data.attributes.bic"/>
                                <label>BIC - nummer</label>
                            </div>
                        </validation>

                        <input type="submit" ng-disabled="form.$invalid" value="Spara"/>

                    </form>
                </div>
            </section>
        </div>

        <!-- USER modal form performed -->
        <div ng-show="userModalPerformShow==2">
            <section>
                <h4>
                    Bra jobbat!<br/>
                    {{company_name}} har godkant utforandet av uppdraget.
                </h4>
                <p>Godkann for att fa ersattningen</p>
                <div>
                    <a class="button dark" href="" ng-click="userModalPerformShow=false">Nej</a>
                    <a class="button pink" href="" ng-click="ctrl.userPerformed()">Ja</a>

                </div>
            </section>
        </div>

        <div class="candidate-chat arriver-chat" ng-show="userModalPerformShow==3">
            <h3>Meddelanden</h3>
            <div>
                <ul>
                    <li ng-repeat="chatMessage in ctrl.chatMessages.data" ng-class="{'right':chatMessage.relationships.author.data.id === ctrl.user_id}">
                        <div class="bubble">
                            <div>{{chatMessage.author.attributes["first-name"]}} {{chatMessage.author.attributes["last-name"]}}</div>
                            <div>{{chatMessage.attributes.body}}</div>
                        </div>
                        <div class="profile-image" style="background-image: url({{chatMessage.author.user_image}})">
                        </div>
                    </li>
                </ul>
                <form name="formChat" ng-submit="ctrl.submitChat()">
                    <div>
                        <div><input type="text" required ng-model="ctrl.chatMessageModel.data.attributes.body"/></div>
                        <div><input type="submit" value="skicka"></div>
                    </div>
                </form>
                <div class="translate"><span>Översätt från svenska</span></div>
            </div>
        </div>

    </div>

</section>